<!DOCTYPE html>
<html lang="en">
  <head>
    <title>What The &#131n!</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Clojure programming game.">
    <meta name="author" content="What The Fn!">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/bootstrap-responsive.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet" media="screen">
  </head>

  <body>
    
    <!-- ACE EDITOR ====================================================================== -->

    <div class="container-fluid">      
      <div class="row-fluid">
        <div class="span9">
          <pre id="editor">;Write a function named the-fn which accepts one numeric argument and returns its square.</pre>
        </div><!--/.span9-->   

        <!-- STATUS WINDOW ================================================================= -->
        <div class="span3">
          <textarea id="statusbox" rows="25" readonly>Game Status</textarea>
        </div><!--span3-->
        
      </div><!-- /.row -->

      <!-- ROW UNDER EDITOR ================================================================================ -->
      <div class="row-fluid">
        <div class="row_under_editor span1">
          <button  id="submitbutton" type="button" class="btn btn-small btn-primary">Submit</button>
        </div><!--/.span1 **-->
        
        <div class="row_under_editor span1 .hidden-phone">
          <div class="btn-group .hidden-phone">
            <button class="btn btn-small .hidden-phone">Theme</button>
            <button class="btn btn-small dropdown-toggle .hidden-phone" data-toggle="dropdown">
              <span class="caret"></span>
            </button>
            <ul class="dropdown-menu .hidden-phone">
              <li rel=",C1,"><dt><span class="text">Bright</span></dt><a tabindex="0" class="opt"><span class="text">Chrome</span></a></li>
              <li rel=",C1,"><a tabindex="1" class="opt"><span class="text">Clouds</span></a></li>
              <li rel=",C1,"><a tabindex="2" class="opt"><span class="text">Crimson Editor</span></a></li>
              <li rel=",C1,"><a tabindex="3" class="opt"><span class="text">Dawn</span></a></li>
              <li rel=",C1,"><a tabindex="4" class="opt"><span class="text">Dreamweaver</span></a></li>
              <li rel=",C1,"><a tabindex="5" class="opt"><span class="text">Eclipse</span></a></li>
              <li rel=",C1,"><a tabindex="6" class="opt"><span class="text">GitHub</span></a></li>
              <li rel=",C1,"><a tabindex="7" class="opt"><span class="text">Solarized Light</span></a></li>
              <li rel=",C1,"><a tabindex="8" class="opt"><span class="text">TextMate</span></a></li>
              <li rel=",C1,"><a tabindex="9" class="opt"><span class="text">Tomorrow</span></a></li>
              <li rel=",C1,"><a tabindex="10" class="opt"><span class="text">Xcode</span></a></li>
              <li rel=",C1,"><dt><span class="text">Dark</span></dt><a tabindex="11" class="opt"><span class="text">Ambiance</span></a></li>
              <li rel=",C1,"><a tabindex="12" class="opt"><span class="text">Chaos</span></a></li>
              <li rel=",C1,"><a tabindex="13" class="opt"><span class="text">Clouds Midnight</span></a></li>
              <li rel=",C1,"><a tabindex="14" class="opt"><span class="text">Cobalt</span></a></li>
              <li rel=",C1,"><a tabindex="15" class="opt"><span class="text">idleFinders</span></a></li>
              <li rel=",C1,"><a tabindex="16" class="opt"><span class="text">Merbivore</span></a></li>
              <li rel=",C1,"><a tabindex="17" class="opt"><span class="text">Merbivore Soft</span></a></li>
              <li rel=",C1,"><a tabindex="18" class="opt"><span class="text">Mono Industrial</span></a></li>
              <li rel=",C1,"><a tabindex="19" class="opt"><span class="text">Monokai</span></a></li>
              <li rel=",C1,"><a tabindex="20" class="opt"><span class="text">Pastel on Dark</span></a></li>
              <li rel=",C1,"><a tabindex="21" class="opt"><span class="text">Solarized Dark</span></a></li>
              <li rel=",C1,"><a tabindex="22" class="opt"><span class="text">Terminal</span></a></li>
              <li rel=",C1,"><a tabindex="23" class="opt"><span class="text">Tomorrow Night Blue</span></a></li>
              <li rel=",C1,"><a tabindex="24" class="opt"><span class="text">Tomorrow Night Bright</span></a></li>
              <li rel=",C1,"><a tabindex="25" class="opt"><span class="text">Tomorrow Night 80s</span></a></li>
              <li rel=",C1,"><a tabindex="26" class="opt"><span class="text">Twilight</span></a></li>
              <li rel=",C1,"><a tabindex="27" class="opt"><span class="text">Vibrant Ink</span></a></li>

              <!-- dropdown menu links -->
            </ul>
          </div>
        </div><!-- /.span1 -->

        <!-- COUNTDOWN CLOCK ==============================================================================-->
        <div class="row_under_editor span2 offset5">
          <span id="clock" class="label pull-right btn-info">Time Remaining: 00:00</span>
        </div><!--/.clock-->

        <!-- CHAT BOX ====================================================================================-->
        <div class="row_under_editor span3 pull-right">
          <div>
            <div class="form-inline">
              <input id="chat_input_box" type="text" class="input-small" placeholder="chat..." >              
            </div>
          </div>
        </div><!--/.row-->

        

        <!-- REPL =========================================================================== -->
      </div><!--/.row-fluid-->

      <div class="row-fluid">
        <div class="span12">  
          <textarea id="repl" rows="20"></textarea>  
        </div><!--/.span12-->
      </div><!--/.row-->
    </div><!-- /.container -->

    
    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/src/ace.js" type="text/javascript" charset="UTF-8"></script>
    <script src="js/wtfn.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.1/underscore-min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.0.0/backbone-min.js"></script>
    <script src="js/gameapi.js"></script>
    <script src="js/messages.js"></script>

    <!-- FROM THE ACE scrollable-page DEMO ============================================== -->
    <script>
      
      var $ = document.getElementById.bind(document);
      var dom = require("ace/lib/dom");
      //add command to all new editor instaces
      require("ace/commands/default_commands").commands.push({
      name: "Toggle Fullscreen",
      bindKey: "F11",
      exec: function(editor) {
      dom.toggleCssClass(document.body, "fullScreen")
      dom.toggleCssClass(editor.container, "fullScreen")
      editor.resize()
      }
      }, {
      name: "add",
      bindKey: "Shift-Return",
      exec: add
      })

      // create first editor
      var editor = ace.edit("editor");
      editor.setTheme("ace/theme/twilight");
      editor.session.setMode("ace/mode/clojure");
      editor.setReadOnly(false);


      var count = 1;
      function add() {
      var oldEl = editor.container
      var pad = document.createElement("div")
      pad.style.padding = "40px"
      oldEl.parentNode.insertBefore(pad, oldEl.nextSibling)

      var el = document.createElement("div")
      oldEl.parentNode.insertBefore(el, pad.nextSibling)

      count++
      var theme = "ace/theme/" + themes[Math.floor(themes.length * Math.random() - 1e-5)]
      editor = ace.edit(el)
      editor.setTheme(theme)
      editor.session.setMode("ace/mode/clojure")

      editor.setValue([
      "this is editor number: ", count, "\n",
      "using theme \"", theme, "\"\n",
      ":)"
      ].join(""), -1)

      scroll()
      }


      function scroll(speed) {
      var top = editor.container.getBoundingClientRect().top
      speed = speed || 10
      if (top > 60 && speed < 500) {
                              if (speed > top - speed - 50)
        speed = top - speed - 50
        else
        setTimeout(scroll, 10, speed + 10)
        window.scrollBy(0, speed)
        }
        }

        var themes = {
        bright: [ "chrome", "clouds", "crimson_editor", "dawn", "dreamweaver", "eclipse", "github",
        "solarized_light", "textmate", "tomorrow"],
        dark: [ "clouds_midnight", "cobalt", "idle_fingers", "kr_theme", "merbivore", "merbivore_soft",
        "mono_industrial", "monokai", "pastel_on_dark", "solarized_dark",  "tomorrow_night",
        "tomorrow_night_blue", "tomorrow_night_bright", "tomorrow_night_eighties", "twilight", "vibrant_ink"]
        }
        themes = [].concat(themes.bright, themes.dark)
        setTimeout(function(){ window.scrollTo(0,0) }, 10)
        
        whatthefn.core.init()

        function myTimer(mymilliseconds) {
        

        var minutes = Math.max(0,Math.floor(mymilliseconds / 60000)); 
        var seconds = Math.max(0,Math.floor((mymilliseconds - (60000 * Math.floor(minutes))) / 1000)); 

        //console.log("myMillis: " + mymilliseconds + " Mins: " + minutes + " Seconds: " + seconds)

        var pminutes = "00";
        var pseconds = "00";

        if (minutes > 9) { pminutes = String(minutes) }
        else if (minutes > 0) { pminutes = "0" + String(minutes) }
        else { pminutes = "00" }

        if (seconds > 9) { pseconds = String(seconds) }
        else if (seconds > 0) { pseconds = "0" + String(seconds) }
        else { pseconds = "00" }

        

        if (minutes > 1) {
        $('clock').className="label pull-right btn-info";        
        $('clock').innerHTML="Time Remaining: " + pminutes + ":" + pseconds;
        }
        else if (minutes > 0) {
        if (seconds == 58 || seconds == 56) { $('clock').className="label pull-right btn-info"; }
        else { $('clock').className="label pull-right btn-warning";}
        $('clock').innerHTML="Time Remaining: " + pminutes + ":" + pseconds;
        }
        else if (seconds > 0) {

        if (seconds == 58 || seconds == 56) { $('clock').className="label pull-right btn-warning"; }
        else if ((10 >= seconds ) && ((seconds % 2) == 0) ) { $('clock').className="label pull-right btn-inverse";  }
        else { $('clock').className="label pull-right btn-danger"; }
        $('clock').innerHTML="Time Remaining: " + pminutes + ":" + pseconds;
        }
        else 
        {
        $('clock').className="label pull-right btn-inverse";
        $('clock').innerHTML="Time's Up! " + pminutes + ":" + pseconds;
        }
        } //myTimer

        

        function updateClock(millisecondsRemaining) {
        }

        var mq = new MessageQueue({
        roomId: 'room-a',
        tickFunction: myTimer,
        handlerFunction: function(m){jQuery('#statusbox').append("\n" + m.getChatString())},

        });
        
        mq.start();
        mq.mock({type: "join", player: "Dar"})
        mq.mock({type: "chat", player: "Dar", string: "WTF! This is awesome!!!"})
        mq.mock({type: "resolve", player: "Dar", testinput: "(f 3)", testoutput: "9"})
        mq.mock({type: "test", player: "Dar", testresult: "Succeeded!"})
        mq.mock({type: "leave", player: "Dar"})
        
    </script>

  </body>

  
</html>
